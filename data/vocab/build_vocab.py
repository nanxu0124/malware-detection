import sys
import os
current_dir = os.path.dirname(__file__)
project_dir = os.path.abspath(os.path.join(current_dir, '../..'))
sys.path.append(project_dir)


import os
import pickle
from tqdm import tqdm
from data.vocab import vocab
from data.ali_data import ali_dataset
from torch.utils.data import DataLoader


# if __name__ == '__main__':

#     # 以下代码构造了 ali_dataset 的词表，并将词表保存到 ali_vocab.pkl 文件中

#     ws = vocab.Vocab()

#     train_dataset = ali_dataset.ALiDataset(train=True)
#     train_dataloader = DataLoader(train_dataset, batch_size=512, shuffle=True, collate_fn=ali_dataset.collate_fn)

#     test_dataset = ali_dataset.ALiDataset(train=False)
#     test_dataloader = DataLoader(test_dataset, batch_size=512, shuffle=True, collate_fn=ali_dataset.collate_fn)

#     for api, label in tqdm(train_dataloader, total=len(train_dataloader)):
#         for sentence in api:
#             ws.fit(sentence)

#     for api, label in tqdm(test_dataloader, total=len(test_dataloader)):
#         for sentence in api:
#             ws.fit(sentence)

#     ws.build_vocab()
#     print(len(ws))
#     pickle.dump(ws, open("./data/ali_data/ali_vocab.pkl", "wb"))

